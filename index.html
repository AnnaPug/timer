<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Timer Editor</title>

<link href="https://fonts.googleapis.com/css2?family=Emilys+Candy&family=Orbitron&family=Rubik+Mono+One&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:#0b1020;
  color:#e9f8ff;
  display:grid;
  grid-template-columns:320px 1fr;
  height:100vh;
}

aside{
  padding:16px;
  background:#0f1733;
  overflow:auto;
}

h2{margin-top:0}

label{display:block;margin-top:12px;font-size:.85rem}

input,select,textarea,button{
  width:100%;
  margin-top:4px;
  padding:6px;
  border-radius:6px;
  border:none;
  font-size:.9rem;
}

button{
  margin-top:14px;
  cursor:pointer;
  background:#63f2ff;
  color:#02030a;
}

.anim-list{
  display:flex;
  gap:8px;
  margin-top:8px;
}

.anim{
  flex:1;
  padding:8px;
  background:#18214a;
  text-align:center;
  border-radius:8px;
  cursor:pointer;
  font-size:.75rem;
}

.anim.active{
  outline:2px solid #63f2ff;
}

main{
  display:flex;
  flex-direction:column;
}

#preview{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#02030a;
}

iframe{
  width:100%;
  height:100%;
  border:none;
}

textarea{
  height:180px;
  background:#02030a;
  color:#63f2ff;
  font-family:monospace;
}
</style>
</head>

<body>

<aside>
  <h2>Timer Editor</h2>

  <label>Длительность (сек)</label>
  <input type="number" id="duration" value="90">

  <label>Шрифт</label>
  <select id="font">
    <option>Emilys Candy</option>
    <option>Orbitron</option>
    <option>Rubik Mono One</option>
  </select>

  <label>Размер шрифта (em)</label>
  <input type="number" step="0.1" id="fontSize" value="3">

  <label>Анимация окончания</label>
  <div class="anim-list">
    <div class="anim active" data-anim="none">None</div>
    <div class="anim" data-anim="pulse">Pulse</div>
    <div class="anim" data-anim="shake">Shake</div>
    <div class="anim" data-anim="flash">Flash</div>
  </div>

  <label>
    <input type="checkbox" id="autoStart" checked>
    Автозапуск
  </label>

  <label>
    <input type="checkbox" id="autoRestart">
    Автоперезапуск
  </label>

  <button onclick="generate()">Сгенерировать код</button>
</aside>

<main>
  <div id="preview">
    <iframe id="frame"></iframe>
  </div>
  <textarea id="output" placeholder="HTML код для Genially"></textarea>
</main>

<script>
const state={
  duration:90,
  font:'Emilys Candy',
  fontSize:3,
  finishAnim:'none',
  autoStart:true,
  autoRestart:false
};

const frame=document.getElementById('frame');

function update(){
  state.duration=+duration.value;
  state.font=font.value;
  state.fontSize=+fontSize.value;
  renderPreview();
}

document.querySelectorAll('.anim').forEach(el=>{
  el.onclick=()=>{
    document.querySelectorAll('.anim').forEach(a=>a.classList.remove('active'));
    el.classList.add('active');
    state.finishAnim=el.dataset.anim;
    renderPreview();
  };
});

['duration','font','fontSize'].forEach(id=>{
  document.getElementById(id).oninput=update;
});

autoStart.onchange=()=>state.autoStart=autoStart.checked;
autoRestart.onchange=()=>state.autoRestart=autoRestart.checked;

function renderPreview(){
  frame.srcdoc=generateHTML(true);
}

function generate(){
  output.value=generateHTML(false);
}

function generateHTML(preview){
return `<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link href="https://fonts.googleapis.com/css2?family=${state.font.replace(/\\s+/g,'+')}&display=swap" rel="stylesheet">
<style>
html,body{
  margin:0;
  width:100%;
  height:100%;
  background:transparent;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}
#timer{
  font-family:'${state.font}',cursive;
  font-size:${state.fontSize}em;
  color:#e9f8ff;
  text-shadow:0 0 10px currentColor;
}
button{
  margin-top:10px;
  padding:6px 14px;
  border:none;
  border-radius:999px;
  background:#63f2ff;
  cursor:pointer;
}
.finish-pulse{animation:pulse .6s infinite}
.finish-shake{animation:shake .4s infinite}
.finish-flash{animation:flash .8s infinite}
@keyframes pulse{50%{transform:scale(1.15)}}
@keyframes shake{
  25%{transform:translateX(-6px)}
  50%{transform:translateX(6px)}
}
@keyframes flash{50%{opacity:.3}}
</style>
</head>
<body>

<div id="timer">0:00</div>
<button onclick="restart()">Restart</button>

<script type="text/javascript">
let total=${state.duration};
let remaining=total;
let el=document.getElementById('timer');
let interval=null;

function format(s){
  return Math.floor(s/60)+':'+(s%60<10?'0':'')+(s%60);
}

function start(){
  clearInterval(interval);
  remaining=total;
  el.className='';
  tick();
  interval=setInterval(tick,1000);
}

function tick(){
  el.textContent=format(remaining);
  if(remaining<=0){
    ${state.finishAnim!=='none' ? `el.classList.add('finish-${state.finishAnim}');` : ``}
    clearInterval(interval);
    ${state.autoRestart ? `setTimeout(start,800);` : ``}
    return;
  }
  remaining--;
}

function restart(){start();}

${state.autoStart ? 'start();' : ''}
</script>

</body>
</html>`;
}

renderPreview();
</script>

</body>
</html>
